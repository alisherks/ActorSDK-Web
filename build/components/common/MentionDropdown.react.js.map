{"version":3,"sources":["../../../src/components/common/MentionDropdown.react.js"],"names":[],"mappings":"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","file":"MentionDropdown.react.js","sourcesContent":["/*\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\n */\n\nimport { map } from 'lodash';\nimport React, { PropTypes, Component } from 'react';\nimport { findDOMNode } from 'react-dom';\nimport classnames from 'classnames';\nimport ReactMixin from 'react-mixin';\nimport PureRenderMixin from 'react-addons-pure-render-mixin';\n\nimport { KeyCodes } from '../../constants/ActorAppConstants';\n\nimport AvatarItem from './AvatarItem.react';\n\nconst DROPDOWN_ITEM_HEIGHT = 38;\nlet scrollIndex = 0;\n\nclass MentionDropdown extends Component {\n  static propTypes = {\n    mentions: PropTypes.array,\n    className: PropTypes.string,\n    onSelect: PropTypes.func.isRequired,\n    onClose: PropTypes.func\n  };\n\n  constructor(props) {\n    super(props);\n    const { mentions } = props;\n\n    this.state = {\n      isOpen: mentions && mentions.length > 0,\n      selectedIndex: 0\n    };\n  }\n\n  componentWillUnmount() {\n    this.cleanListeners();\n  }\n\n  componentWillUpdate(nextProps, nextState) {\n    if (nextState.isOpen && !this.state.isOpen) {\n      this.setListeners();\n    } else if (!nextState.isOpen && this.state.isOpen) {\n      this.cleanListeners();\n    }\n  }\n\n  componentWillReceiveProps(props) {\n    const { mentions } = props;\n    this.setState({\n      isOpen: mentions && mentions.length > 0,\n      selectedIndex: 0\n    });\n  }\n\n  setListeners() {\n    document.addEventListener('keydown', this.onKeyDown, false);\n    document.addEventListener('click', this.closeMentions, false);\n  }\n\n  cleanListeners() {\n    document.removeEventListener('keydown', this.onKeyDown, false);\n    document.removeEventListener('click', this.closeMentions, false);\n  }\n\n  closeMentions = () => this.setState({isOpen: false});\n\n  onSelect = (value) => this.props.onSelect(value);\n\n  handleScroll = (top) => {\n    const menuListNode = findDOMNode(this.refs.mentionList);\n    menuListNode.scrollTop = top;\n  };\n\n  onKeyDown = (event) => {\n    const { mentions, onClose } = this.props;\n    const { selectedIndex } = this.state;\n    const visibleItems = 6;\n    let index = selectedIndex;\n\n    if (index !== null) {\n      switch (event.keyCode) {\n        case KeyCodes.ENTER:\n          event.stopPropagation();\n          event.preventDefault();\n          this.onSelect(mentions[selectedIndex]);\n          break;\n\n        case KeyCodes.ARROW_UP:\n          event.stopPropagation();\n          event.preventDefault();\n\n          if (index > 0) {\n            index -= 1;\n          } else if (index === 0) {\n            index = mentions.length - 1;\n          }\n\n          if (scrollIndex > index) {\n            scrollIndex = index;\n          } else if (index === mentions.length - 1) {\n            scrollIndex = mentions.length - visibleItems;\n          }\n\n          this.handleScroll(scrollIndex * DROPDOWN_ITEM_HEIGHT);\n          this.setState({selectedIndex: index});\n          break;\n        case KeyCodes.ARROW_DOWN:\n        case KeyCodes.TAB:\n          event.stopPropagation();\n          event.preventDefault();\n\n          if (index < mentions.length - 1) {\n            index += 1;\n          } else if (index === mentions.length - 1) {\n            index = 0;\n          }\n\n          if (index + 1 > scrollIndex + visibleItems) {\n            scrollIndex = index + 1 - visibleItems;\n          } else if (index === 0) {\n            scrollIndex = 0;\n          }\n\n          this.handleScroll(scrollIndex * DROPDOWN_ITEM_HEIGHT);\n          this.setState({selectedIndex: index});\n          break;\n        default:\n      }\n    }\n\n    if (event.keyCode === KeyCodes.ESC) {\n      this.closeMentions();\n      if (onClose) onClose();\n    }\n  };\n\n  render() {\n    const { className, mentions } = this.props;\n    const { isOpen, selectedIndex } = this.state;\n\n    const mentionClassName = classnames('mention', {\n      'mention--opened': isOpen\n    }, className);\n    const mentionsElements = map(mentions, (mention, index) => {\n      const itemClassName = classnames('mention__list__item', {\n        'mention__list__item--active': selectedIndex === index\n      });\n\n      const title = mention.isNick ? [\n        <span className=\"nickname\">{mention.mentionText}</span>,\n        <span className=\"name\">{mention.secondText}</span>\n      ] : (\n        <span className=\"name\">{mention.mentionText}</span>\n      );\n\n      return (\n        <li className={itemClassName}\n            key={index}\n            onClick={() => this.onSelect(mention)}\n            onMouseOver={() => this.setState({selectedIndex: index})}>\n          <AvatarItem image={mention.peer.avatar}\n                      placeholder={mention.peer.placeholder}\n                      size=\"tiny\"\n                      title={mention.peer.title}/>\n          <div className=\"title\">{title}</div>\n        </li>\n      );\n    });\n\n    if (isOpen) {\n      return (\n        <div className={mentionClassName}>\n          <div className=\"mention__wrapper\">\n            <header className=\"mention__header\">\n              <div className=\"pull-left\"><strong>tab</strong>&nbsp; or &nbsp;<strong>↑</strong><strong>↓</strong>&nbsp; to navigate</div>\n              <div className=\"pull-left\"><strong>↵</strong>&nbsp; to select</div>\n              <div className=\"pull-right\"><strong>esc</strong>&nbsp; to close</div>\n            </header>\n            <ul className=\"mention__list\" ref=\"mentionList\">\n              {mentionsElements}\n            </ul>\n          </div>\n        </div>\n      );\n    } else {\n      return null;\n    }\n  }\n}\n\nReactMixin.onClass(MentionDropdown, PureRenderMixin);\n\nexport default MentionDropdown;\n"]}