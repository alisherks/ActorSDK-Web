{"version":3,"sources":["../../../../src/components/dialog/messages/MessageItem.react.js"],"names":[],"mappings":"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","file":"MessageItem.react.js","sourcesContent":["/*\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\n */\n\nimport { escape } from 'lodash';\nimport React, { Component, PropTypes } from 'react';\nimport { Container } from 'flux/utils';\nimport classnames from 'classnames';\nimport { escapeWithEmoji } from '../../../utils/EmojiUtils';\nimport PeerUtils from '../../../utils/PeerUtils';\nimport { MessageContentTypes } from '../../../constants/ActorAppConstants';\n\nimport DialogActionCreators from '../../../actions/DialogActionCreators';\nimport ActivityActionCreators from '../../../actions/ActivityActionCreators';\nimport DropdownActionCreators from '../../../actions/DropdownActionCreators';\n\nimport DropdownStore from '../../../stores/DropdownStore';\n\nimport AvatarItem from '../../common/AvatarItem.react';\nimport State from './State.react';\nimport Reactions from './Reactions.react';\n\n// Default message content components\nimport DefaultService from './Service.react';\nimport DefaultText from './Text.react';\nimport DefaultPhoto from './Photo.react.js';\nimport DefaultDocument from './Document.react';\nimport DefaultVoice from './Voice.react';\nimport DefaultContact from './Contact.react';\nimport DefaultLocation from './Location.react.js';\nimport DefaultModern from './Modern.react.js';\nimport DefaultSticker from './Sticker.react.js';\n\nclass MessageItem extends Component {\n  static getStores = () => [DropdownStore];\n\n  static calculateState(prevState, props) {\n    return {\n      isHighlighted: props && props.message ? DropdownStore.isMessageDropdownOpen(props.message.rid) : false\n    }\n  }\n\n  static propTypes = {\n    peer: PropTypes.object.isRequired,\n    message: PropTypes.object.isRequired,\n    overlay: PropTypes.object.isRequired,\n    isShortMessage: PropTypes.bool,\n    isSelected: PropTypes.bool,\n    onSelect: PropTypes.func\n  };\n\n  static contextTypes = {\n    delegate: PropTypes.object,\n    isExperimental: PropTypes.bool\n  };\n\n  shouldComponentUpdate(nextProps, nextState) {\n    return (this.props.message !== nextProps.message || this.props.isShortMessage != nextProps.isShortMessage);\n  }\n\n  onClick = () => {\n    const { message, peer } = this.props;\n\n    if (PeerUtils.equals(peer, message.sender.peer)) {\n      ActivityActionCreators.show();\n    } else {\n      DialogActionCreators.selectDialogPeerUser(message.sender.peer.id);\n    }\n  };\n\n  showActions = (event) => {\n    const { message } = this.props;\n    DropdownActionCreators.openMessageActions(event.target.getBoundingClientRect(), message);\n  };\n\n  toggleMessageSelection = () => {\n    const { message, onSelect } = this.props;\n    onSelect && onSelect(message.rid);\n  };\n\n  render() {\n    const { message, overlay, peer, isSelected } = this.props;\n    const { isHighlighted } = this.state;\n    const { delegate, isExperimental } = this.context;\n    const isShortMessage = overlay.useShort;\n\n    let Service, Text, Modern, Photo, Document, Voice, Contact, Location, Sticker;\n    if (delegate.components.dialog && delegate.components.dialog.messages && delegate.components.dialog.messages.message !== null && typeof delegate.components.messages.message !== 'function') {\n      Service = delegate.components.dialog.messages.service || DefaultService;\n      Text = delegate.components.dialog.messages.text || DefaultText;\n      Modern = delegate.components.dialog.messages.modern || DefaultModern;\n      Photo = delegate.components.dialog.messages.photo || DefaultPhoto;\n      Document = delegate.components.dialog.messages.document || DefaultDocument;\n      Voice = delegate.components.dialog.messages.voice || DefaultVoice;\n      Contact = delegate.components.dialog.messages.contact || DefaultContact;\n      Location = delegate.components.dialog.messages.location || DefaultLocation;\n      Sticker = delegate.components.dialog.messages.sticker || DefaultSticker;\n    } else {\n      Service = DefaultService;\n      Text = DefaultText;\n      Modern = DefaultModern;\n      Photo = DefaultPhoto;\n      Document = DefaultDocument;\n      Voice = DefaultVoice;\n      Contact = DefaultContact;\n      Location = DefaultLocation;\n      Sticker = DefaultSticker;\n    }\n\n    let header = null,\n        messageContent = null,\n        leftBlock = null;\n\n    const messageSender = escapeWithEmoji(message.sender.title);\n\n    const messageClassName = classnames('message row', {\n      'message--same-sender': isShortMessage,\n      'message--active': isHighlighted,\n      'message--selected': isSelected\n    });\n    const messageActionsMenuClassName = classnames('message__actions__menu', {\n      'message__actions__menu--opened': isHighlighted\n    });\n\n    if (isShortMessage) {\n      leftBlock = (\n        <div className=\"message__info text-right\">\n          <time className=\"message__timestamp\">{message.date}</time>\n          <State message={message}/>\n        </div>\n      );\n    } else {\n      leftBlock = (\n        <div className=\"message__info message__info--avatar\">\n          <a onClick={this.onClick}>\n            <AvatarItem image={message.sender.avatar}\n                        placeholder={message.sender.placeholder}\n                        title={message.sender.title}/>\n          </a>\n        </div>\n      );\n      header = (\n        <header className=\"message__header\">\n          <h3 className=\"message__sender\">\n            <a onClick={this.onClick}>\n              {\n                message.sender.title\n                  ? <span className=\"message__sender__name\" dangerouslySetInnerHTML={{__html: messageSender}}/>\n                  : null\n              }\n              {\n                message.sender.userName\n                  ? <span className=\"message__sender__nick\">@{message.sender.userName}</span>\n                  : null\n              }\n            </a>\n          </h3>\n          <time className=\"message__timestamp\">{message.date}</time>\n          <State message={message}/>\n        </header>\n      );\n    }\n\n    switch (message.content.content) {\n      case MessageContentTypes.SERVICE:\n        messageContent = <Service {...message.content} className=\"message__content message__content--service\"/>;\n        break;\n      case MessageContentTypes.TEXT:\n        messageContent = <Text {...message.content} className=\"message__content message__content--text\"/>;\n        break;\n      case MessageContentTypes.PHOTO:\n        messageContent = (<Photo content={message.content} className=\"message__content message__content--photo\"\n                                loadedClassName=\"message__content--photo--loaded\"/>);\n        break;\n      case MessageContentTypes.DOCUMENT:\n        messageContent = <Document content={message.content} className=\"message__content message__content--document\"/>;\n        break;\n      case MessageContentTypes.VOICE:\n        messageContent = <Voice content={message.content} className=\"message__content message__content--voice\"/>;\n        break;\n      case MessageContentTypes.CONTACT:\n        messageContent = <Contact {...message.content} className=\"message__content message__content--contact\"/>;\n        break;\n      case MessageContentTypes.LOCATION:\n        messageContent = <Location content={message.content} className=\"message__content message__content--location\"/>;\n        break;\n      case MessageContentTypes.TEXT_MODERN:\n        messageContent = <Modern {...message.content} className=\"message__content message__content--modern\"/>;\n        break;\n      case MessageContentTypes.STICKER:\n        messageContent = <Sticker {...message.content} className=\"message__content message__content--sticker\"/>;\n        break;\n      default:\n    }\n\n    return (\n      <li className={messageClassName}>\n        {leftBlock}\n        <div className=\"message__body col-xs\">\n          {header}\n          {messageContent}\n        </div>\n        <div className=\"message__actions\">\n          <Reactions peer={peer} message={message}/>\n\n          <div className={messageActionsMenuClassName} onClick={this.showActions}>\n            <svg className=\"icon icon--dropdown\"\n                 dangerouslySetInnerHTML={{__html: '<use xlink:href=\"assets/images/icons.svg#cog\"/>'}}/>\n          </div>\n\n          {\n            isExperimental\n              ? <div className=\"message__actions__selector\" onClick={this.toggleMessageSelection}>\n                  <i className=\"icon material-icons\">check</i>\n                </div>\n              : null\n          }\n\n        </div>\n      </li>\n    );\n  }\n}\n\nexport default Container.create(MessageItem, {withProps: true});\n"]}