{"version":3,"sources":["../../src/components/Call.react.js"],"names":[],"mappings":"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","file":"Call.react.js","sourcesContent":["/*\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\n */\n\nimport React, { Component } from 'react';\nimport classNames from 'classnames';\nimport { Container } from 'flux/utils';\nimport { FormattedMessage } from 'react-intl';\n\nimport { PeerTypes } from '../constants/ActorAppConstants';\nimport PeerUtils from '../utils/PeerUtils';\n\nimport CallActionCreators from '../actions/CallActionCreators';\n\nimport CallStore from '../stores/CallStore';\nimport DialogStore from '../stores/DialogStore';\nimport UserStore from '../stores/UserStore';\nimport GroupStore from '../stores/GroupStore';\n\nimport CallDraggable from './call/CallDraggable.react';\nimport CallHeader from './call/CallHeader.react';\nimport CallBody from './call/CallBody.react';\nimport CallControls from './call/CallControls.react';\nimport ContactDetails from './common/ContactDetails.react';\n\nclass Call extends Component {\n  static getStores = () => [CallStore, DialogStore];\n\n  static calculatePeerInfo(peer) {\n    if (peer) {\n      if (peer.type === PeerTypes.USER) {\n        return UserStore.getUser(peer.id);\n      }\n\n      if (peer.type === PeerTypes.GROUP) {\n        return GroupStore.getGroup(peer.id);\n      }\n    }\n\n    return null;\n  }\n\n  static calculateState() {\n    const dialogPeer = DialogStore.getCurrentPeer();\n    const callPeer = CallStore.getPeer();\n\n    return {\n      isOpen: CallStore.isOpen(),\n      isOutgoing: CallStore.isOutgoing(),\n      isMuted: CallStore.isMuted(),\n      callId: CallStore.getId(),\n      callMembers: CallStore.getMembers(),\n      callPeer: CallStore.getPeer(),\n      callState: CallStore.getState(),\n      peerInfo: Call.calculatePeerInfo(callPeer),\n      isSameDialog: PeerUtils.equals(dialogPeer, callPeer)\n    };\n  }\n\n  constructor(props) {\n    super(props);\n    this.onAnswer = this.onAnswer.bind(this);\n    this.onEnd = this.onEnd.bind(this);\n    this.onMuteToggle = this.onMuteToggle.bind(this);\n    this.onClose = this.onClose.bind(this);\n    this.onFullscreen = this.onFullscreen.bind(this);\n    this.onUserAdd = this.onUserAdd.bind(this);\n    this.onVideo = this.onVideo.bind(this);\n  }\n\n  onAnswer() {\n    CallActionCreators.answerCall(this.state.callId);\n  }\n\n  onEnd() {\n    console.log(this.state.callId);\n    CallActionCreators.endCall(this.state.callId);\n  }\n\n  onMuteToggle() {\n    CallActionCreators.toggleCallMute(this.state.callId);\n  }\n\n  onClose() {\n    CallActionCreators.hide();\n  }\n\n  onFullscreen() {\n    console.debug('onFullscreen');\n  }\n\n  onUserAdd() {\n    console.debug('onUserAdd');\n  }\n\n  onVideo() {\n    console.debug('onVideo');\n  }\n\n  renderContactInfo() {\n    const { callPeer, peerInfo } = this.state;\n    if (!peerInfo || callPeer.type === PeerTypes.GROUP) return null;\n\n    return (\n      <section className=\"call__info\">\n        <ContactDetails peerInfo={peerInfo}/>\n      </section>\n    )\n  }\n\n  render() {\n    const {isOpen, callState, peerInfo, isOutgoing, isMuted, isSameDialog} = this.state;\n    if (!isOpen) {\n      return null;\n    }\n\n    if (!this.state.isSameDialog) {\n      return (\n        <CallDraggable\n          peerInfo={peerInfo}\n          callState={callState}\n          isOutgoing={isOutgoing}\n          isMuted={isMuted}\n          onEnd={this.onEnd}\n          onAnswer={this.onAnswer}\n          onMuteToggle={this.onMuteToggle}\n          onFullscreen={this.onFullscreen}\n          onUserAdd={this.onUserAdd}\n          onVideo={this.onVideo}\n          onClose={this.onClose}\n        />\n      );\n    }\n\n    return (\n      <section className=\"activity activity--shown\">\n        <div className=\"activity__body call\">\n          <section className=\"call__container\">\n            <CallBody peerInfo={peerInfo} callState={callState}/>\n            <CallControls\n              callState={callState}\n              isOutgoing={isOutgoing}\n              isMuted={isMuted}\n              onEnd={this.onEnd}\n              onAnswer={this.onAnswer}\n              onMuteToggle={this.onMuteToggle}\n              onFullscreen={this.onFullscreen}\n              onUserAdd={this.onUserAdd}\n              onVideo={this.onVideo}\n              onClose={this.onClose}\n            />\n          </section>\n          {this.renderContactInfo()}\n        </div>\n      </section>\n    );\n  }\n}\n\nexport default Container.create(Call);\n"]}