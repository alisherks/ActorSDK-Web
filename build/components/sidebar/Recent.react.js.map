{"version":3,"sources":["../../../src/components/sidebar/Recent.react.js"],"names":[],"mappings":"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","file":"Recent.react.js","sourcesContent":["/*\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\n */\n\nimport { forEach, map, debounce } from 'lodash';\n\nimport React, { Component, PropTypes } from 'react';\nimport { findDOMNode } from 'react-dom';\nimport { Link } from 'react-router';\nimport { FormattedMessage } from 'react-intl';\nimport  classnames from 'classnames';\n\nimport CreateGroupActionCreators from '../../actions/CreateGroupActionCreators';\nimport ContactActionCreators from '../../actions/ContactActionCreators';\nimport GroupListActionCreators from '../../actions/GroupListActionCreators';\nimport AddContactActionCreators from '../../actions/AddContactActionCreators';\n\nimport Scrollbar from '../common/Scrollbar.react';\nimport RecentItem from './RecentItem.react';\n\nclass Recent extends Component {\n  constructor(props) {\n    super(props);\n\n    this.checkInvisibleCounters = debounce(this.checkInvisibleCounters, 50, {\n      maxWait: 150,\n      leading: true\n    });\n\n    this.state = {\n      haveUnreadAbove: false,\n      haveUnreadBelow: false,\n      lastUnreadBelow: null,\n      firstUnreadAbove: null\n    }\n  }\n\n  static contextTypes = {\n    intl: PropTypes.object\n  };\n\n  static propTypes = {\n    dialogs: PropTypes.array.isRequired\n  };\n\n  componentDidUpdate(prevProps) {\n    if (prevProps !== this.props) {\n      this.checkInvisibleCounters();\n    }\n  }\n\n  handleCreateGroup = () => CreateGroupActionCreators.open();\n\n  handleCreatePrivate = () => AddContactActionCreators.open();\n\n  handleGroupListClick = () => GroupListActionCreators.open();\n\n  handlePrivateListClick = () => ContactActionCreators.open();\n\n  handleRecentScroll = () => this.checkInvisibleCounters();\n\n  checkInvisibleCounters = () => {\n    const unreadNodes = document.getElementsByClassName('sidebar__list__item--unread');\n    const scrollNode = findDOMNode(this.refs.container);\n    const scrollNodeRect = scrollNode.getBoundingClientRect();\n\n    let haveUnreadAbove = false,\n        haveUnreadBelow = false,\n        lastUnreadBelow = null,\n        firstUnreadAbove = null;\n\n    forEach(unreadNodes, (node) => {\n      const rect = node.getBoundingClientRect();\n      if ((scrollNodeRect.top + scrollNodeRect.height) < rect.top) {\n        haveUnreadBelow = true;\n        lastUnreadBelow = node;\n      }\n      if (scrollNodeRect.top > (rect.top + rect.height)) {\n        haveUnreadAbove = true;\n        if (!firstUnreadAbove) {\n          firstUnreadAbove = node;\n        }\n      }\n    });\n\n    this.setState({ haveUnreadAbove, haveUnreadBelow, firstUnreadAbove, lastUnreadBelow });\n  };\n\n  scrollToFirstHiddenAbove = () => {\n    const { firstUnreadAbove } = this.state;\n    const rect = firstUnreadAbove.getBoundingClientRect();\n    const scrollNode = findDOMNode(this.refs.container).getElementsByClassName('ss-scrollarea')[0];\n    const scrollNodeRect = scrollNode.getBoundingClientRect();\n\n    this.refs.container.scrollTo(scrollNode.scrollTop + rect.top - scrollNodeRect.top)\n  };\n\n  scrollToLastHiddenBelow = () => {\n    const { lastUnreadBelow } = this.state;\n    const rect = lastUnreadBelow.getBoundingClientRect();\n    const scrollNode = findDOMNode(this.refs.container).getElementsByClassName('ss-scrollarea')[0];\n    const scrollNodeRect = scrollNode.getBoundingClientRect();\n\n    this.refs.container.scrollTo(scrollNode.scrollTop + rect.top - (scrollNodeRect.top + scrollNodeRect.height - rect.height));\n  };\n\n  render() {\n    const { dialogs } = this.props;\n    const { haveUnreadAbove, haveUnreadBelow } = this.state;\n    const { intl } = this.context;\n\n    const recentGroups = map(dialogs, (dialogGroup, index) => {\n      const isEmpty = dialogGroup.shorts.length === 0;\n      let groupTitle;\n\n      switch (dialogGroup.key) {\n        case 'groups':\n          groupTitle = (\n            <li className=\"sidebar__list__title\">\n              <a onClick={this.handleGroupListClick}>{intl.messages[`sidebar.recents.${dialogGroup.key}`]}</a>\n              <i className=\"material-icons sidebar__list__title__icon pull-right\"\n                 onClick={this.handleCreateGroup}>add_circle_outline</i>\n            </li>\n          );\n          break;\n        case 'privates':\n          groupTitle = (\n            <li className=\"sidebar__list__title\">\n              <a onClick={this.handlePrivateListClick}>{intl.messages[`sidebar.recents.${dialogGroup.key}`]}</a>\n              <i className=\"material-icons sidebar__list__title__icon pull-right\"\n                 onClick={this.handleCreatePrivate}>add_circle_outline</i>\n            </li>\n          );\n          break;\n        default:\n          groupTitle = <li className=\"sidebar__list__title\">{intl.messages[`sidebar.recents.${dialogGroup.key}`]}</li>;\n      }\n\n      const groupList = map(dialogGroup.shorts, (dialog, index) => <RecentItem dialog={dialog}\n                                                                               key={index}\n                                                                               type={dialogGroup.key}/>);\n\n      const groupClassname = classnames(`sidebar__list sidebar__list--${dialogGroup.key}`, {\n       'sidebar__list--empty': isEmpty\n      });\n\n      const getEmptyMessage = () => {\n        switch (dialogGroup.key) {\n          case 'groups':\n            return (\n              <li className=\"sidebar__list__item sidebar__list__item--empty\">\n                <FormattedMessage id=\"sidebar.group.empty\"/>\n                <div className=\"stem\"/>\n              </li>\n            )\n          case 'privates':\n            return (\n              <li className=\"sidebar__list__item sidebar__list__item--empty\">\n                <FormattedMessage id=\"sidebar.private.empty\"/>\n                <button className=\"button button--outline button--wide hide\">\n                  <FormattedMessage id=\"button.invite\"/>\n                </button>\n              </li>\n            )\n          default:\n            return null;\n        }\n      }\n\n      return (\n        <ul className={groupClassname} key={index}>\n          {groupTitle}\n          {\n            isEmpty\n              ? getEmptyMessage()\n              : groupList\n          }\n        </ul>\n      )\n    });\n\n    return (\n      <section className=\"sidebar__recent\">\n        {\n          haveUnreadAbove\n            ? <div className=\"sidebar__recent__unread sidebar__recent__unread--above\" onClick={this.scrollToFirstHiddenAbove}>\n                <i className=\"material-icons\">keyboard_arrow_up</i>\n              </div>\n            : null\n        }\n        <Scrollbar ref=\"container\" onScroll={this.handleRecentScroll}>\n          <div>\n            {recentGroups}\n\n            <footer>\n              <Link to=\"/im/archive\" className=\"button button--rised button--wide\">\n                <FormattedMessage id=\"button.archive\"/>\n              </Link>\n            </footer>\n          </div>\n        </Scrollbar>\n        {\n          haveUnreadBelow\n            ? <div className=\"sidebar__recent__unread sidebar__recent__unread--below\" onClick={this.scrollToLastHiddenBelow}>\n                <i className=\"material-icons\">keyboard_arrow_down</i>\n              </div>\n            : null\n        }\n      </section>\n    );\n  }\n}\n\nexport default Recent;\n"]}