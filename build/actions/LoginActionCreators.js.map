{"version":3,"sources":["../../src/actions/LoginActionCreators.js"],"names":[],"mappings":"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","file":"LoginActionCreators.js","sourcesContent":["/*\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\n */\n\nimport { dispatch, dispatchAsync } from '../dispatcher/ActorAppDispatcher';\nimport { ActionTypes } from '../constants/ActorAppConstants';\n\nimport ActorClient from '../utils/ActorClient';\nimport history from '../utils/history';\nimport DelegateContainer from '../utils/DelegateContainer';\nimport LocationContainer from '../utils/LocationContainer';\n\nimport MyProfileActionCreators from './MyProfileActionCreators';\nimport DialogActionCreators from './DialogActionCreators';\nimport ContactActionCreators from './ContactActionCreators';\nimport QuickSearchActionCreators from './QuickSearchActionCreators';\nimport FaviconActionCreators from './FaviconActionCreators';\nimport EventBusActionCreators from './EventBusActionCreators';\n\nconst LoginActionCreators = {\n  changeLogin(login) {\n    dispatch(ActionTypes.AUTH_CHANGE_LOGIN, { login })\n  },\n\n  changeCode(code) {\n    dispatch(ActionTypes.AUTH_CHANGE_CODE, { code })\n  },\n\n  changeName(name) {\n    dispatch(ActionTypes.AUTH_CHANGE_NAME, { name })\n  },\n\n  requestCode(phone) {\n    const isEmail = /@/.test(phone);\n    let promise;\n    if (/@/.test(phone)) {\n      promise = ActorClient.requestCodeEmail(phone);\n    } else {\n      promise = ActorClient.requestSms(phone);\n    }\n\n    dispatchAsync(promise, {\n      request: ActionTypes.AUTH_CODE_REQUEST,\n      success: ActionTypes.AUTH_CODE_REQUEST_SUCCESS,\n      failure: ActionTypes.AUTH_CODE_REQUEST_FAILURE\n    }, { phone });\n  },\n\n  requestSms(phone) {\n    dispatchAsync(ActorClient.requestSms(phone), {\n      request: ActionTypes.AUTH_CODE_REQUEST,\n      success: ActionTypes.AUTH_CODE_REQUEST_SUCCESS,\n      failure: ActionTypes.AUTH_CODE_REQUEST_FAILURE\n    }, { phone });\n  },\n\n  sendCode(code) {\n    const sendCodePromise = () => dispatchAsync(ActorClient.sendCode(code), {\n      request: ActionTypes.AUTH_CODE_SEND,\n      success: ActionTypes.AUTH_CODE_SEND_SUCCESS,\n      failure: ActionTypes.AUTH_CODE_SEND_FAILURE\n    }, { code });\n\n    const handleState = (state) => {\n      switch (state) {\n        case 'signup':\n          this.startSignup();\n          break;\n        case 'logged_in':\n          this.setLoggedIn({redirect: true});\n          break;\n        default:\n          console.error('Unsupported state', state);\n      }\n    };\n\n    sendCodePromise()\n      .then(handleState);\n  },\n\n  startSignup() {\n    dispatch(ActionTypes.AUTH_SIGNUP_START);\n  },\n\n  sendSignup(name) {\n    const signUpPromise = () => dispatchAsync(ActorClient.signUp(name), {\n      request: ActionTypes.AUTH_SIGNUP,\n      success: ActionTypes.AUTH_SIGNUP_SUCCESS,\n      failure: ActionTypes.AUTH_SIGNUP_FAILURE\n    }, { name });\n\n    const setLoggedIn = () => this.setLoggedIn({redirect: true});\n\n    signUpPromise()\n      .then(setLoggedIn)\n  },\n\n  setLoggedIn(opts = {}) {\n    const delegate = DelegateContainer.get();\n\n    if (delegate.actions.setLoggedIn) {\n      delegate.actions.setLoggedIn(opts);\n    } else {\n      if (opts.redirect) {\n        const location = LocationContainer.get();\n        const nextPathname = location.state ? location.state.nextPathname : null;\n\n        if (nextPathname) {\n          history.replace(nextPathname);\n        } else {\n          history.replace('/');\n        }\n      }\n\n      ActorClient.bindUser(ActorClient.getUid(), MyProfileActionCreators.onProfileChanged);\n      // ActorClient.bindDialogs(DialogActionCreators.setDialogs);\n      ActorClient.bindGroupDialogs(DialogActionCreators.setDialogs);\n      ActorClient.bindContacts(ContactActionCreators.setContacts);\n      ActorClient.bindSearch(QuickSearchActionCreators.setQuickSearchList);\n      ActorClient.bindTempGlobalCounter(FaviconActionCreators.setFavicon);\n      ActorClient.bindEventBus(EventBusActionCreators.broadcastEvent);\n      dispatch(ActionTypes.AUTH_SET_LOGGED_IN);\n    }\n  },\n\n  setLoggedOut() {\n    const delegate = DelegateContainer.get();\n\n    if (delegate.actions.setLoggedOut) {\n      delegate.actions.setLoggedOut();\n    } else {\n      ActorClient.unbindUser(ActorClient.getUid(), MyProfileActionCreators.onProfileChanged);\n      ActorClient.unbindDialogs(DialogActionCreators.setDialogs);\n      // ActorClient.unbindContacts(ContactActionCreators.setContacts);\n      ActorClient.unbindGroupDialogs(DialogActionCreators.setDialogs);\n      ActorClient.unbindSearch(QuickSearchActionCreators.setQuickSearchList);\n      ActorClient.unbindTempGlobalCounter(FaviconActionCreators.setFavicon);\n      ActorClient.unbindEventBus(EventBusActionCreators.broadcastEvent);\n      dispatch(ActionTypes.AUTH_SET_LOGGED_OUT);\n    }\n  },\n\n  restartAuth() {\n    dispatch(ActionTypes.AUTH_RESTART)\n  }\n};\n\nexport default LoginActionCreators;\n"]}