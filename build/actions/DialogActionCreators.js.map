{"version":3,"sources":["../../src/actions/DialogActionCreators.js"],"names":[],"mappings":"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","file":"DialogActionCreators.js","sourcesContent":["/*\n * Copyright (C) 2015 Actor LLC. <https://actor.im>\n */\n\nimport { dispatch, dispatchAsync } from '../dispatcher/ActorAppDispatcher';\nimport { ActionTypes, PeerTypes } from '../constants/ActorAppConstants';\nimport history from '../utils/history';\nimport ActorClient from '../utils/ActorClient';\nimport PeerUtils from '../utils/PeerUtils';\n\nimport MessageActionCreators from './MessageActionCreators';\nimport TypingActionCreators from './TypingActionCreators';\nimport DialogInfoActionCreators from './DialogInfoActionCreators';\nimport OnlineActionCreators from './OnlineActionCreators';\nimport GroupProfileActionCreators from './GroupProfileActionCreators';\nimport DraftActionCreators from './DraftActionCreators';\n\nimport DialogStore from '../stores/DialogStore';\n\nlet messagesBinding = null;\n\nconst DialogActionCreators = {\n  setDialogs(dialogs) {\n    dispatch(ActionTypes.DIALOGS_CHANGED, { dialogs });\n  },\n\n  selectDialogPeer(peer) {\n    const currentPeer = DialogStore.getCurrentPeer();\n\n    // Unbind from previous peer\n    if (currentPeer !== null) {\n      DraftActionCreators.saveDraft(currentPeer);\n      dispatch(ActionTypes.UNBIND_DIALOG_PEER, { peer: currentPeer });\n\n      this.onConversationClosed(currentPeer);\n      messagesBinding && messagesBinding.unbind();\n      ActorClient.unbindTyping(currentPeer, TypingActionCreators.setTyping);\n\n      switch (currentPeer.type) {\n        case PeerTypes.USER:\n          ActorClient.unbindUser(currentPeer.id, DialogInfoActionCreators.setDialogInfo);\n          ActorClient.unbindUserOnline(currentPeer.id, OnlineActionCreators.setUserOnline);\n          break;\n        case PeerTypes.GROUP:\n          ActorClient.unbindGroup(currentPeer.id, DialogInfoActionCreators.setDialogInfo);\n          ActorClient.unbindGroupOnline(currentPeer.id, OnlineActionCreators.setGroupOnline);\n          break;\n        default:\n      }\n    }\n\n    if (peer !== null) {\n      dispatch(ActionTypes.BIND_DIALOG_PEER, { peer });\n      DraftActionCreators.loadDraft(peer);\n\n      this.onConversationOpen(peer);\n      messagesBinding = ActorClient.bindMessages(peer, MessageActionCreators.setMessages);\n      ActorClient.bindTyping(peer, TypingActionCreators.setTyping);\n\n      switch(peer.type) {\n        case PeerTypes.USER:\n          ActorClient.bindUser(peer.id, DialogInfoActionCreators.setDialogInfo);\n          ActorClient.bindUserOnline(peer.id, OnlineActionCreators.setUserOnline);\n          break;\n        case PeerTypes.GROUP:\n          ActorClient.bindGroup(peer.id, DialogInfoActionCreators.setDialogInfo);\n          ActorClient.bindGroupOnline(peer.id, OnlineActionCreators.setGroupOnline);\n          GroupProfileActionCreators.getIntegrationToken(peer.id);\n          break;\n        default:\n      }\n    }\n  },\n\n  selectDialogPeerUser(uid) {\n    if (uid === ActorClient.getUid()) {\n      console.warn('You can\\'t chat with yourself');\n    } else {\n      history.push(`/im/${PeerUtils.peerToString(ActorClient.getUserPeer(uid))}`);\n    }\n  },\n\n  onConversationOpen(peer) {\n    ActorClient.onConversationOpen(peer);\n  },\n\n  onConversationClosed(peer) {\n    ActorClient.onConversationClosed(peer);\n  },\n\n  onDialogsEnd() {\n    ActorClient.onDialogsEnd();\n  },\n\n  onChatEnd(peer) {\n    ActorClient.onChatEnd(peer);\n  },\n\n  leaveGroup(gid) {\n    dispatchAsync(ActorClient.leaveGroup(gid), {\n      request: ActionTypes.GROUP_LEAVE,\n      success: ActionTypes.GROUP_LEAVE_SUCCESS,\n      failure: ActionTypes.GROUP_LEAVE_ERROR\n    }, { gid });\n  },\n\n  deleteChat(peer) {\n    const gid = peer.id;\n    const leaveGroup = () => dispatchAsync(ActorClient.leaveGroup(gid), {\n      request: ActionTypes.GROUP_LEAVE,\n      success: ActionTypes.GROUP_LEAVE_SUCCESS,\n      failure: ActionTypes.GROUP_LEAVE_ERROR\n    }, { gid });\n    const deleteChat = () => dispatchAsync(ActorClient.deleteChat(peer), {\n      request: ActionTypes.GROUP_DELETE,\n      success: ActionTypes.GROUP_DELETE_SUCCESS,\n      failure: ActionTypes.GROUP_DELETE_ERROR\n    }, { peer });\n\n    switch (peer.type) {\n      case PeerTypes.USER:\n        deleteChat();\n        break;\n      case PeerTypes.GROUP:\n        leaveGroup()\n          .then(deleteChat);\n        break;\n      default:\n    }\n  },\n\n  clearChat(peer) {\n    dispatchAsync(ActorClient.clearChat(peer), {\n      request: ActionTypes.GROUP_CLEAR,\n      success: ActionTypes.GROUP_CLEAR_SUCCESS,\n      failure: ActionTypes.GROUP_CLEAR_ERROR\n    }, { peer });\n  },\n\n  hideChat(peer) {\n    dispatchAsync(ActorClient.hideChat(peer), {\n      request: ActionTypes.GROUP_HIDE,\n      success: ActionTypes.GROUP_HIDE_SUCCESS,\n      failure: ActionTypes.GROUP_HIDE_ERROR\n    }, { peer });\n  }\n};\n\nexport default DialogActionCreators;\n"]}